generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Organization {
  id                   String           @id @default(uuid())
  name                 String
  code                 String           @unique
  type                 OrganizationType
  industryType         IndustryType     @default(GOVERNMENT)
  isActive             Boolean          @default(true)
  createdAt            DateTime         @default(now())
  updatedAt            DateTime         @updatedAt
  location             String?
  parentOrganizationId String?
  phoneNumber          String?
  maxUsers             Int              @default(100)
  status               TenantStatus     @default(APPROVED)
  subscriptionTier     SubscriptionTier @default(STARTER)
  expirationDate       DateTime?
  documents            Document[]
  events               Event[]
  receivedLetters      Letter[]         @relation("RecipientOrg")
  sentLetters          Letter[]         @relation("SenderOrg")
  ccLetters            LetterCC[]
  letterCounters       LetterCounter[]
  templates            LetterTemplate[]
  receivedMessages     Message[]        @relation("RecipientOrg")
  parentOrganization   Organization?    @relation("OrgHierarchy", fields: [parentOrganizationId], references: [id])
  subOrganizations     Organization[]   @relation("OrgHierarchy")
  school               School?
  users                User[]
}

model RegistrationRequest {
  id             String            @id @default(uuid())
  orgName        String
  orgType        OrganizationType
  orgCode        String            @unique
  contactPerson  String
  officialEmail  String
  identitySystem String
  phone          String?
  intendedUse    String?
  status         TenantStatus      @default(PENDING)
  assignedTier   SubscriptionTier?
  reviewedById   String?
  industryType   IndustryType      @default(GOVERNMENT)
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  reviewedBy     User?             @relation("RequestReviewer", fields: [reviewedById], references: [id])
}

model User {
  id               String                @id @default(uuid())
  fullName         String
  email            String                @unique
  passwordHash     String
  role             Role                  @default(OFFICER)
  organizationId   String?
  isActive         Boolean               @default(true)
  createdAt        DateTime              @default(now())
  updatedAt        DateTime              @updatedAt
  phoneNumber      String?
  position         String?
  signatureUrl     String?
  profileImageUrl  String?
  createdDocuments Document[]            @relation("DocumentCreator")
  documents        Document[]            @relation("DocumentOwner")
  approvedLeaves   LeaveRequest[]        @relation("ApprovedLeaves")
  leaves           LeaveRequest[]        @relation("EmployeeLeaves")
  createdLetters   Letter[]              @relation("LetterCreator")
  receivedLetters  Letter[]              @relation("LetterRecipient")
  sentMessages     Message[]             @relation("MessageSender")
  receivedMessages Message[]             @relation("MessageRecipient")
  parent           Parent?
  reviews          PerformanceReview[]   @relation("EmployeeReviews")
  givenReviews     PerformanceReview[]   @relation("ReviewerReviews")
  reviewedRequests RegistrationRequest[] @relation("RequestReviewer")
  stamps           Stamp[]
  student          Student?
  teacher          Teacher?
  organization     Organization?         @relation(fields: [organizationId], references: [id])
}

model LetterTemplate {
  id             String        @id @default(uuid())
  name           String
  letterType     LetterType
  content        String
  isActive       Boolean       @default(true)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  organizationId String?
  letters        Letter[]
  organization   Organization? @relation(fields: [organizationId], references: [id])

  @@unique([name, organizationId])
}

model Letter {
  id                String             @id @default(uuid())
  referenceNumber   String             @unique
  subject           String
  content           String
  letterType        LetterType
  status            LetterStatus       @default(DRAFT)
  classification    Classification     @default(INTERNAL)
  senderOrgId       String?
  recipientOrgId    String?
  recipientUserId   String?
  createdById       String
  templateId        String?
  letterDate        DateTime           @default(now())
  sentAt            DateTime?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  stampId           Int?
  stampX            Float?
  stampY            Float?
  headerImage       String?
  applicationStatus ApplicationStatus  @default(PENDING)
  createdBy         User               @relation("LetterCreator", fields: [createdById], references: [id])
  recipientOrg      Organization?      @relation("RecipientOrg", fields: [recipientOrgId], references: [id])
  recipientUser     User?              @relation("LetterRecipient", fields: [recipientUserId], references: [id])
  senderOrg         Organization?      @relation("SenderOrg", fields: [senderOrgId], references: [id])
  stamp             Stamp?             @relation(fields: [stampId], references: [id])
  template          LetterTemplate?    @relation(fields: [templateId], references: [id])
  attachments       LetterAttachment[]
  ccRecipients      LetterCC[]
  messages          Message[]
}

model Message {
  id             String        @id @default(uuid())
  content        String
  letterId       String?
  senderId       String
  recipientId    String?
  recipientOrgId String?
  isRead         Boolean       @default(false)
  createdAt      DateTime      @default(now())
  letter         Letter?       @relation(fields: [letterId], references: [id])
  recipientOrg   Organization? @relation("RecipientOrg", fields: [recipientOrgId], references: [id])
  recipient      User?         @relation("MessageRecipient", fields: [recipientId], references: [id])
  sender         User          @relation("MessageSender", fields: [senderId], references: [id])
}

model LetterCC {
  id             String       @id @default(uuid())
  letterId       String
  organizationId String
  createdAt      DateTime     @default(now())
  letter         Letter       @relation(fields: [letterId], references: [id], onDelete: Cascade)
  organization   Organization @relation(fields: [organizationId], references: [id])

  @@unique([letterId, organizationId])
}

model LetterAttachment {
  id        String   @id @default(uuid())
  letterId  String
  fileName  String
  fileUrl   String
  fileSize  Int
  createdAt DateTime @default(now())
  letter    Letter   @relation(fields: [letterId], references: [id], onDelete: Cascade)
}

model LetterCounter {
  id             String        @id @default(uuid())
  orgId          String
  year           Int
  value          Int
  organizationId String?
  organization   Organization? @relation(fields: [organizationId], references: [id])

  @@unique([orgId, year])
}

model Document {
  id              String         @id @default(uuid())
  title           String
  referenceNumber String         @unique
  description     String?
  fileName        String
  fileUrl         String?
  fileSize        Int
  type            DocumentType   @default(OTHER)
  ownerId         String?
  createdById     String
  organizationId  String?
  classification  Classification @default(INTERNAL)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  createdBy       User           @relation("DocumentCreator", fields: [createdById], references: [id])
  organization    Organization?  @relation(fields: [organizationId], references: [id])
  owner           User?          @relation("DocumentOwner", fields: [ownerId], references: [id])
}

model Stamp {
  id        Int      @id @default(autoincrement())
  userId    String
  imageUrl  String
  createdAt DateTime @default(now())
  letters   Letter[]
  user      User     @relation(fields: [userId], references: [id])
}

model LandingPageContent {
  id           String   @id @default("hero")
  heroTitle    String   @default("IAM for everyone in your organization.")
  heroDesc     String   @default("The market leader trusted by 1.7 million customers. Manage your official correspondence with the security and efficiency of FIRMA.")
  featuresJson String   @default("[]")
  updatedAt    DateTime @updatedAt
}

model LeaveRequest {
  id           String      @id @default(uuid())
  employeeId   String
  type         LeaveType
  startDate    DateTime
  endDate      DateTime
  reason       String?
  status       LeaveStatus @default(PENDING)
  approvedById String?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  approvedBy   User?       @relation("ApprovedLeaves", fields: [approvedById], references: [id])
  employee     User        @relation("EmployeeLeaves", fields: [employeeId], references: [id])
}

model PerformanceReview {
  id         String   @id @default(uuid())
  employeeId String
  reviewerId String
  rating     Int
  comments   String?
  reviewDate DateTime @default(now())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  employee   User     @relation("EmployeeReviews", fields: [employeeId], references: [id])
  reviewer   User     @relation("ReviewerReviews", fields: [reviewerId], references: [id])
}

model School {
  id              String         @id @default(uuid())
  organizationId  String         @unique
  motto           String?
  principalId     String?
  establishedYear Int?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  academicYears   AcademicYear[]
  classes         Class[]
  organization    Organization   @relation(fields: [organizationId], references: [id])
  subjects        Subject[]
}

model Student {
  id              String            @id @default(uuid())
  userId          String            @unique
  admissionNumber String            @unique
  classId         String?
  dateOfBirth     DateTime?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  attendances     Attendance[]
  grades          Grade[]
  class           Class?            @relation(fields: [classId], references: [id])
  user            User              @relation(fields: [userId], references: [id])
  guardians       StudentGuardian[]
}

model Teacher {
  id             String           @id @default(uuid())
  userId         String           @unique
  employeeNumber String           @unique
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  classes        ClassTeacher[]
  user           User             @relation(fields: [userId], references: [id])
  subjects       TeacherSubject[]
  timetables     Timetable[]
}

model Parent {
  id        String            @id @default(uuid())
  userId    String            @unique
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
  user      User              @relation(fields: [userId], references: [id])
  children  StudentGuardian[]
}

model StudentGuardian {
  id           String       @id @default(uuid())
  studentId    String
  parentId     String
  relationship GuardianType @default(PARENT)
  isPrimary    Boolean      @default(false)
  parent       Parent       @relation(fields: [parentId], references: [id])
  student      Student      @relation(fields: [studentId], references: [id])

  @@unique([studentId, parentId])
}

model Class {
  id           String         @id @default(uuid())
  name         String
  grade        String
  section      String?
  schoolId     String
  academicYear String
  capacity     Int            @default(40)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  school       School         @relation(fields: [schoolId], references: [id])
  subjects     ClassSubject[]
  teachers     ClassTeacher[]
  students     Student[]
  timetables   Timetable[]
}

model Subject {
  id          String           @id @default(uuid())
  name        String
  code        String
  schoolId    String
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  grade       String?
  attendances Attendance[]
  classes     ClassSubject[]
  grades      Grade[]
  school      School           @relation(fields: [schoolId], references: [id])
  teachers    TeacherSubject[]
  timetables  Timetable[]

  @@unique([code, schoolId, grade])
}

model Event {
  id             String       @id @default(uuid())
  title          String
  description    String?
  startDate      DateTime
  endDate        DateTime?
  location       String?
  organizationId String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  organization   Organization @relation(fields: [organizationId], references: [id])
}

model Grade {
  id         String    @id @default(uuid())
  studentId  String
  subjectId  String
  termId     String
  score      Float
  maxScore   Float     @default(100)
  gradeType  GradeType @default(EXAM)
  remarks    String?
  gradedById String
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  student    Student   @relation(fields: [studentId], references: [id])
  subject    Subject   @relation(fields: [subjectId], references: [id])
  term       Term      @relation(fields: [termId], references: [id])
}

model Attendance {
  id         String           @id @default(uuid())
  studentId  String
  date       DateTime
  status     AttendanceStatus @default(PRESENT)
  remarks    String?
  markedById String
  createdAt  DateTime         @default(now())
  subjectId  String?
  student    Student          @relation(fields: [studentId], references: [id])
  subject    Subject?         @relation(fields: [subjectId], references: [id])
}

model AcademicYear {
  id        String   @id @default(uuid())
  name      String
  startDate DateTime
  endDate   DateTime
  isCurrent Boolean  @default(false)
  schoolId  String
  createdAt DateTime @default(now())
  school    School   @relation(fields: [schoolId], references: [id])
  terms     Term[]
}

model Term {
  id             String       @id @default(uuid())
  name           String
  startDate      DateTime
  endDate        DateTime
  academicYearId String
  createdAt      DateTime     @default(now())
  grades         Grade[]
  academicYear   AcademicYear @relation(fields: [academicYearId], references: [id])
}

model Timetable {
  id        String   @id @default(uuid())
  classId   String
  subjectId String
  teacherId String
  dayOfWeek Int
  startTime String
  endTime   String
  room      String?
  createdAt DateTime @default(now())
  class     Class    @relation(fields: [classId], references: [id])
  subject   Subject  @relation(fields: [subjectId], references: [id])
  teacher   Teacher  @relation(fields: [teacherId], references: [id])
}

model ClassTeacher {
  id        String  @id @default(uuid())
  classId   String
  teacherId String
  isHead    Boolean @default(false)
  class     Class   @relation(fields: [classId], references: [id])
  teacher   Teacher @relation(fields: [teacherId], references: [id])

  @@unique([classId, teacherId])
}

model TeacherSubject {
  id        String  @id @default(uuid())
  teacherId String
  subjectId String
  subject   Subject @relation(fields: [subjectId], references: [id])
  teacher   Teacher @relation(fields: [teacherId], references: [id])

  @@unique([teacherId, subjectId])
}

model ClassSubject {
  id        String  @id @default(uuid())
  classId   String
  subjectId String
  class     Class   @relation(fields: [classId], references: [id])
  subject   Subject @relation(fields: [subjectId], references: [id])

  @@unique([classId, subjectId])
}

enum DocumentType {
  PERSONAL
  TRAINING
  NATIONAL_ID
  CONTRACT
  REVIEW
  PAYROLL
  OTHER
}

enum IndustryType {
  GOVERNMENT
  EDUCATION
  HEALTHCARE
  FINANCE
  LEGAL
  PRIVATE
  OTHER
}

enum Role {
  SUPER_ADMIN
  ORG_ADMIN
  OFFICER
  REVIEWER
  HR
  APPLICANT
  SCHOOL_ADMIN
  TEACHER
  STUDENT
  PARENT
}

enum ApplicationStatus {
  PENDING
  UNDER_REVIEW
  APPROVED
  REJECTED
  ADDITIONAL_INFO_REQUIRED
}

enum LetterStatus {
  DRAFT
  SENT
  RECEIVED
  CC
  ARCHIVED
}

enum LetterType {
  HIERARCHICAL
  CROSS_STRUCTURE
  STAFF
  C_STAFF
  HEAD_OFFICE
  GUEST
}

enum Classification {
  PUBLIC
  INTERNAL
  CONFIDENTIAL
}

enum OrganizationType {
  MINISTRY
  AGENCY
  REGION
  SUB_ORGANIZATION
  OFFICE
  SOE
  ENTERPRISE
  EDUCATION
  SCHOOL
  COLLEGE
  UNIVERSITY
}

enum SubscriptionTier {
  STARTER
  CONSORTIUM
  NATIONAL
  ENTERPRISE_LITE
}

enum TenantStatus {
  PENDING
  REVIEWING
  APPROVED
  REJECTED
  PILOT
}

enum LeaveType {
  ANNUAL
  SICK
  MATERNITY
  PATERNITY
  UNPAID
  OTHER
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

enum GradeType {
  EXAM
  TEST
  ASSIGNMENT
  PROJECT
  PRACTICAL
  QUIZ
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  EXCUSED
}

enum GuardianType {
  FATHER
  MOTHER
  PARENT
  GUARDIAN
  OTHER
}
